<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="CSCD70 2023s Assignment1 Introduction to LLVM 记录"><meta name="keywords" content="Base"><meta name="author" content="Kr0emer"><meta name="copyright" content="Kr0emer"><title>CSCD70 2023s Assignment1 Introduction to LLVM 记录 | Kr0emerのBlog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CSCD70-2023s-Assignment1-Introduction-to-LLVM-%E8%AE%B0%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">CSCD70 2023s Assignment1 Introduction to LLVM 记录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FunctionInfo"><span class="toc-number">1.1.</span> <span class="toc-text">FunctionInfo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LocalOpts"><span class="toc-number">1.2.</span> <span class="toc-text">LocalOpts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-AlgebraicIdentity"><span class="toc-number">1.2.1.</span> <span class="toc-text">1-AlgebraicIdentity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-StrengthReduction"><span class="toc-number">1.2.2.</span> <span class="toc-text">2-StrengthReduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-MultiInstOpt"><span class="toc-number">1.2.3.</span> <span class="toc-text">3-MultiInstOpt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FileCheck"><span class="toc-number">1.2.4.</span> <span class="toc-text">FileCheck</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://kr0emer-blog-1306550410.cos.ap-nanjing.myqcloud.com/img/psc.jpg"></div><div class="author-info__name text-center">Kr0emer</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/Kr0emer">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">13</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">6</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">8</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">Links</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://lonmar.cn/">L0nm4r</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://www.aerol1te.xyz">Aerol1te</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://blog.csdn.net/wuyvle?spm=1000.2115.3001.5343">Wondermaker</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://eeeeeeeeeeeeeeeea.cn">Eeee</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://pyozo.top">Pyozo</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://kr0emer-blog-1306550410.cos.ap-nanjing.myqcloud.com/img/72177032_p0.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Kr0emerのBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">CSCD70 2023s Assignment1 Introduction to LLVM 记录</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-07-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Base/">Base</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Base/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">2.2k</span><span class="post-meta__separator">|</span><span>Reading time: 11 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="CSCD70-2023s-Assignment1-Introduction-to-LLVM-记录"><a href="#CSCD70-2023s-Assignment1-Introduction-to-LLVM-记录" class="headerlink" title="CSCD70 2023s Assignment1 Introduction to LLVM 记录"></a>CSCD70 2023s Assignment1 Introduction to LLVM 记录</h1><p>这里我只附上代码和效果哈，具体的实验要求和过程看这个<a target="_blank" rel="noopener" href="https://www.overleaf.com/read/nvmnmbntgwqn">链接</a></p>
<h2 id="FunctionInfo"><a href="#FunctionInfo" class="headerlink" title="FunctionInfo"></a>FunctionInfo</h2><p>这个函数主要是收集信息，主要是打印对齐需要注意一下</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;llvm/Passes/PassBuilder.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;llvm/Passes/PassPlugin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;llvm/Support/raw_ostream.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FunctionInfoPass</span> <span class="keyword">final</span> :</span> <span class="keyword">public</span> PassInfoMixin&lt;FunctionInfoPass&gt; &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function">PreservedAnalyses <span class="title">run</span><span class="params">([[maybe_unused]] Module &amp;M, ModuleAnalysisManager &amp;)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">outs</span>() &lt;&lt; <span class="string">&quot;CSCD70 Function Information Pass&quot;</span></span><br><span class="line">           &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="built_in">outs</span>() &lt;&lt; <span class="string">&quot;-----------------------------------------------------------------\n&quot;</span>;</span><br><span class="line">    <span class="built_in">outs</span>()&lt;&lt;formatv(<span class="string">&quot;&#123;0,=20&#125;&#123;1,=10&#125;&#123;2,=10&#125;&#123;3,=10&#125;&#123;4,=10&#125;\n&quot;</span>,<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;#Args&quot;</span>,<span class="string">&quot;#Calls&quot;</span>,<span class="string">&quot;#Blocks&quot;</span>,<span class="string">&quot;#Insts&quot;</span>);</span><br><span class="line">    <span class="built_in">outs</span>() &lt;&lt; <span class="string">&quot;-----------------------------------------------------------------\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(Function &amp;F : M)&#123;</span><br><span class="line">      <span class="keyword">if</span>(F.<span class="built_in">isDeclaration</span>()) <span class="keyword">continue</span>;<span class="comment">//跳过函数声明</span></span><br><span class="line">            <span class="built_in">analyzeFunction</span>(F);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">outs</span>() &lt;&lt; <span class="string">&quot;-----------------------------------------------------------------\n&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">analyzeFunction</span><span class="params">(Function &amp;F)</span></span>&#123;</span><br><span class="line">    StringRef funcName = F.<span class="built_in">getName</span>();<span class="comment">//获取函数名</span></span><br><span class="line">    <span class="keyword">unsigned</span> argNum = F.<span class="built_in">arg_size</span>();<span class="comment">//获取参数个数</span></span><br><span class="line">    <span class="keyword">unsigned</span> callNum = F.<span class="built_in">getNumUses</span>();<span class="comment">//获取被调用次数</span></span><br><span class="line">    <span class="keyword">unsigned</span> bbNum = F.<span class="built_in">size</span>();<span class="comment">//基本块个数</span></span><br><span class="line">    <span class="keyword">unsigned</span> instrNum = F.<span class="built_in">getInstructionCount</span>();<span class="comment">//指令总数</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">outs</span>() &lt;&lt; formatv(<span class="string">&quot;&#123;0,=20&#125;&#123;1,=10&#125;&#123;2,=10&#125;&#123;3,=10&#125;&#123;4,=10&#125;\n&quot;</span>,</span><br><span class="line">                 funcName, </span><br><span class="line">                 argNum, </span><br><span class="line">                 callNum, </span><br><span class="line">                 bbNum, </span><br><span class="line">                 instrNum);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;; <span class="comment">// class FunctionInfoPass</span></span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// anonymous namespace</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function">PassPluginLibraryInfo <span class="title">llvmGetPassPluginInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">      .APIVersion = LLVM_PLUGIN_API_VERSION,</span><br><span class="line">      .PluginName = <span class="string">&quot;FunctionInfo&quot;</span>,</span><br><span class="line">      .PluginVersion = LLVM_VERSION_STRING,</span><br><span class="line">      .RegisterPassBuilderCallbacks =</span><br><span class="line">          [](PassBuilder &amp;PB) &#123;</span><br><span class="line">            PB.<span class="built_in">registerPipelineParsingCallback</span>(</span><br><span class="line">                [](StringRef Name, ModulePassManager &amp;MPM,</span><br><span class="line">                   ArrayRef&lt;PassBuilder::PipelineElement&gt;) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">                  <span class="keyword">if</span> (Name == <span class="string">&quot;function-info&quot;</span>) &#123;</span><br><span class="line">                    MPM.<span class="built_in">addPass</span>(<span class="built_in">FunctionInfoPass</span>());</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;);</span><br><span class="line">          &#125; <span class="comment">// RegisterPassBuilderCallbacks</span></span><br><span class="line">  &#125;;        <span class="comment">// struct PassPluginLibraryInfo</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>效果如下</p>
<p><img src="https://kr0emer-blog-1306550410.cos.ap-nanjing.myqcloud.com/img/image-20250701115438028.png" alt="image-20250701115438028"></p>
<h2 id="LocalOpts"><a href="#LocalOpts" class="headerlink" title="LocalOpts"></a>LocalOpts</h2><h3 id="1-AlgebraicIdentity"><a href="#1-AlgebraicIdentity" class="headerlink" title="1-AlgebraicIdentity"></a>1-AlgebraicIdentity</h3><p>这个函数是用来处理一些诸如<strong>𝑥 + 0 = 0 + 𝑥, 𝑥 × 1 = 1 × 𝑥 ⇒ 𝑥</strong>的情况,值得注意的是，除法和减法注意处理两个操作数一致的情况</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LocalOpts.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="function">PreservedAnalyses <span class="title">AlgebraicIdentityPass::run</span><span class="params">([[maybe_unused]] Function &amp;F,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             FunctionAnalysisManager &amp;)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">//这里作为练习只考虑Add，Sub，Mul，SDiv，不考虑无符号数</span></span><br><span class="line">  <span class="keyword">bool</span> Changed = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;BB : F)</span><br><span class="line">  &#123;</span><br><span class="line">    SmallVector&lt;Instruction *, <span class="number">16</span>&gt; DeadInsts; <span class="comment">// 收集待删除指令,如果小于16个就保存在栈，如果大于就存在堆里</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;I : <span class="built_in">make_early_inc_range</span>(BB))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>(isa&lt;BinaryOperator&gt;(I))</span><br><span class="line">      &#123;</span><br><span class="line">        Value *Op1 = I.<span class="built_in">getOperand</span>(<span class="number">0</span>);<span class="comment">//获取操作数</span></span><br><span class="line">        Value *Op2 = I.<span class="built_in">getOperand</span>(<span class="number">1</span>);</span><br><span class="line">        ConstantInt *CI1 = dyn_cast&lt;ConstantInt&gt;(Op1);<span class="comment">//尝试转化为常量</span></span><br><span class="line">        ConstantInt *CI2 = dyn_cast&lt;ConstantInt&gt;(Op2);</span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span> (I.<span class="built_in">getOpcode</span>()) </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> Instruction::Add:<span class="comment">//加法</span></span><br><span class="line">            <span class="keyword">if</span>(CI1 &amp;&amp; CI1-&gt;<span class="built_in">isZero</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(Op2);</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(CI2 &amp;&amp; CI2-&gt;<span class="built_in">isZero</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(Op1);</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> Instruction::Sub:<span class="comment">//减法</span></span><br><span class="line">            <span class="keyword">if</span>(CI2 &amp;&amp; CI2-&gt;<span class="built_in">isZero</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(Op1);</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(Op1 == Op2)</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(ConstantInt::<span class="built_in">getSigned</span>(I.<span class="built_in">getType</span>(), <span class="number">0</span>));</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> Instruction::Mul:<span class="comment">//乘法</span></span><br><span class="line">            <span class="keyword">if</span>(CI1 &amp;&amp; CI1-&gt;<span class="built_in">isOne</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(Op2);</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(CI2 &amp;&amp; CI2-&gt;<span class="built_in">isOne</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(Op1);</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> Instruction::SDiv:<span class="comment">//除法</span></span><br><span class="line">            <span class="keyword">if</span>(CI2 &amp;&amp; CI2-&gt;<span class="built_in">isOne</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(Op1);</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Op1 == Op2)</span><br><span class="line">            &#123;</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(ConstantInt::<span class="built_in">getSigned</span>(I.<span class="built_in">getType</span>(), <span class="number">1</span>));</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!DeadInsts.<span class="built_in">empty</span>()) </span><br><span class="line">    &#123;</span><br><span class="line">      Changed = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">for</span> (Instruction *DeadI : DeadInsts) </span><br><span class="line">      &#123;</span><br><span class="line">        DeadI-&gt;<span class="built_in">eraseFromParent</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Changed ? PreservedAnalyses::<span class="built_in">none</span>() : PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-StrengthReduction"><a href="#2-StrengthReduction" class="headerlink" title="2-StrengthReduction"></a>2-StrengthReduction</h3><p>这个函数是处理<strong>4 × 𝑥 = 𝑥 × 4 ⇒ or 𝑥 ≪ 2</strong>这种情况的，包括除法和乘法，注意除法要使用Ash防止被除数为负数</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LocalOpts.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">PreservedAnalyses <span class="title">StrengthReductionPass::run</span><span class="params">([[maybe_unused]] Function &amp;F,</span></span></span><br><span class="line"><span class="params"><span class="function">                                             FunctionAnalysisManager &amp;)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">bool</span> Changed = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;BB:F)</span><br><span class="line">  &#123;</span><br><span class="line">    SmallVector&lt;Instruction *, <span class="number">16</span>&gt; DeadInsts; <span class="comment">// 收集待删除指令,如果小于16个就保存在栈，如果大于就存在堆里</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;I:<span class="built_in">make_early_inc_range</span>(BB))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>(isa&lt;BinaryOperator&gt;(I))</span><br><span class="line">      &#123;</span><br><span class="line">        Value *Op1 = I.<span class="built_in">getOperand</span>(<span class="number">0</span>);<span class="comment">//获取操作数</span></span><br><span class="line">        Value *Op2 = I.<span class="built_in">getOperand</span>(<span class="number">1</span>);</span><br><span class="line">        ConstantInt *CI1 = dyn_cast&lt;ConstantInt&gt;(Op1);<span class="comment">//尝试转化为常量</span></span><br><span class="line">        ConstantInt *CI2 = dyn_cast&lt;ConstantInt&gt;(Op2);</span><br><span class="line">        <span class="keyword">bool</span> StrengthFlag = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span> (I.<span class="built_in">getOpcode</span>()) </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> Instruction::Mul:<span class="comment">//乘法</span></span><br><span class="line">            <span class="keyword">if</span>( CI1 &amp;&amp; CI1-&gt;<span class="built_in">getSExtValue</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">isPowerOf2_64</span>(CI1-&gt;<span class="built_in">getZExtValue</span>()))</span><br><span class="line">            &#123;</span><br><span class="line">              Value* ShiftVal = ConstantInt::<span class="built_in">get</span>(CI1-&gt;<span class="built_in">getType</span>(),<span class="built_in">countTrailingZeros</span>(CI1-&gt;<span class="built_in">getZExtValue</span>()));</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(</span><br><span class="line">                BinaryOperator::<span class="built_in">Create</span>(Instruction::Shl, Op2, ShiftVal, <span class="string">&quot;&quot;</span>, &amp;I)</span><br><span class="line">              );</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(CI2 &amp;&amp; CI2-&gt;<span class="built_in">getSExtValue</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">isPowerOf2_64</span>(CI2-&gt;<span class="built_in">getZExtValue</span>()))</span><br><span class="line">            &#123;</span><br><span class="line">              Value* ShiftVal = ConstantInt::<span class="built_in">get</span>(CI2-&gt;<span class="built_in">getType</span>(),<span class="built_in">countTrailingZeros</span>(CI2-&gt;<span class="built_in">getZExtValue</span>()));</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(</span><br><span class="line">                BinaryOperator::<span class="built_in">Create</span>(Instruction::Shl, Op1, ShiftVal, <span class="string">&quot;&quot;</span>, &amp;I)</span><br><span class="line">              );</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> Instruction::SDiv:<span class="comment">//除法</span></span><br><span class="line">            <span class="keyword">if</span>(CI2 &amp;&amp; CI2-&gt;<span class="built_in">getSExtValue</span>() &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">isPowerOf2_64</span>(CI2-&gt;<span class="built_in">getZExtValue</span>()))</span><br><span class="line">            &#123;</span><br><span class="line">              Value* ShiftVal = ConstantInt::<span class="built_in">get</span>(CI2-&gt;<span class="built_in">getType</span>(),<span class="built_in">countTrailingZeros</span>(CI2-&gt;<span class="built_in">getZExtValue</span>()));</span><br><span class="line">              I.<span class="built_in">replaceAllUsesWith</span>(</span><br><span class="line">                BinaryOperator::<span class="built_in">Create</span>(Instruction::AShr, Op1, ShiftVal, <span class="string">&quot;&quot;</span>, &amp;I)</span><br><span class="line">              );</span><br><span class="line">              DeadInsts.<span class="built_in">push_back</span>(&amp;I);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!DeadInsts.<span class="built_in">empty</span>())</span><br><span class="line">    &#123;</span><br><span class="line">      Changed = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">for</span>(Instruction *DeadI : DeadInsts)&#123;</span><br><span class="line">        DeadI-&gt;<span class="built_in">eraseFromParent</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Changed ? PreservedAnalyses::<span class="built_in">none</span>() : PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-MultiInstOpt"><a href="#3-MultiInstOpt" class="headerlink" title="3-MultiInstOpt"></a>3-MultiInstOpt</h3><p>这个函数是多指令优化，主要是处理<strong>𝑎 = 𝑏 + 1, 𝑐 = 𝑎 − 1 ⇒ 𝑎 = 𝑏 + 1, 𝑐 = 𝑏</strong>这种情况的,这里我一开始还准备优化除法和乘法，但是最后写完了才发现有可能出现溢出的情况，所以不适用，就只做了加法和减法的</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;LocalOpts.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> llvm;</span><br><span class="line"></span><br><span class="line"><span class="function">PreservedAnalyses <span class="title">MultiInstOptPass::run</span><span class="params">([[maybe_unused]] Function &amp;F,</span></span></span><br><span class="line"><span class="params"><span class="function">                                        FunctionAnalysisManager &amp;)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">bool</span> Changed = <span class="literal">false</span>;</span><br><span class="line">  SmallVector&lt;Instruction *, <span class="number">32</span>&gt; DeadInsts;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;BB : <span class="built_in">make_early_inc_range</span>(F))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;I:<span class="built_in">make_early_inc_range</span>(BB))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span>(isa&lt;BinaryOperator&gt;(I))</span><br><span class="line">      &#123;</span><br><span class="line">        Value *Op1 = I.<span class="built_in">getOperand</span>(<span class="number">0</span>);<span class="comment">//获取操作数</span></span><br><span class="line">        Value *Op2 = I.<span class="built_in">getOperand</span>(<span class="number">1</span>);</span><br><span class="line">        ConstantInt *CI1 = dyn_cast&lt;ConstantInt&gt;(Op1);<span class="comment">//尝试转化为常量</span></span><br><span class="line">        ConstantInt *CI2 = dyn_cast&lt;ConstantInt&gt;(Op2);</span><br><span class="line">        Value *Var = <span class="literal">nullptr</span>;</span><br><span class="line">        ConstantInt *Con = <span class="literal">nullptr</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(CI1 &amp;&amp; !CI2)</span><br><span class="line">        &#123;</span><br><span class="line">          Con = CI1;</span><br><span class="line">          Var = Op2;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!CI1 &amp;&amp; CI2)</span><br><span class="line">        &#123;</span><br><span class="line">          Con = CI2;</span><br><span class="line">          Var = Op1;</span><br><span class="line">        &#125;<span class="keyword">else</span> </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in"><span class="keyword">switch</span></span> (I.<span class="built_in">getOpcode</span>()) </span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> Instruction::Add:</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> *U : I.<span class="built_in">users</span>())</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">if</span>(<span class="keyword">auto</span> *II = dyn_cast&lt;BinaryOperator&gt;(U))</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">if</span>(II-&gt;<span class="built_in">getOpcode</span>()==Instruction::Sub &amp;&amp; II-&gt;<span class="built_in">getOperand</span>(<span class="number">0</span>) == &amp;I)</span><br><span class="line">                &#123;</span><br><span class="line">                  ConstantInt *CCI2 = dyn_cast&lt;ConstantInt&gt;(II-&gt;<span class="built_in">getOperand</span>(<span class="number">1</span>));</span><br><span class="line">                  <span class="keyword">if</span>(CCI2 &amp;&amp; (CCI2-&gt;<span class="built_in">getValue</span>() == Con-&gt;<span class="built_in">getValue</span>()))</span><br><span class="line">                  &#123;</span><br><span class="line">                    II-&gt;<span class="built_in">replaceAllUsesWith</span>(Var);</span><br><span class="line">                    DeadInsts.<span class="built_in">push_back</span>(II);</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;       </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">case</span> Instruction :: Sub:</span><br><span class="line">          &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(!CI1 &amp;&amp; CI2)</span><br><span class="line">            &#123;</span><br><span class="line">              </span><br><span class="line">              SmallVector&lt;Instruction *, <span class="number">16</span>&gt; DeadInsts;</span><br><span class="line">              <span class="keyword">for</span>(<span class="keyword">auto</span> *U : I.<span class="built_in">users</span>())</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">auto</span> *II = dyn_cast&lt;BinaryOperator&gt;(U))</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="keyword">if</span>(II-&gt;<span class="built_in">getOpcode</span>()==Instruction::Add)</span><br><span class="line">                  &#123;</span><br><span class="line">                    ConstantInt *CCI1 = dyn_cast&lt;ConstantInt&gt;(II-&gt;<span class="built_in">getOperand</span>(<span class="number">0</span>));</span><br><span class="line">                    ConstantInt *CCI2 = dyn_cast&lt;ConstantInt&gt;(II-&gt;<span class="built_in">getOperand</span>(<span class="number">1</span>));</span><br><span class="line">                    <span class="keyword">if</span>(II-&gt;<span class="built_in">getOperand</span>(<span class="number">0</span>) == &amp;I)</span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="keyword">if</span>(CCI1 &amp;&amp; CCI1-&gt;<span class="built_in">getValue</span>() == Con-&gt;<span class="built_in">getValue</span>())</span><br><span class="line">                      &#123;</span><br><span class="line">                        II-&gt;<span class="built_in">replaceAllUsesWith</span>(Var);</span><br><span class="line">                        DeadInsts.<span class="built_in">push_back</span>(II);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (II-&gt;<span class="built_in">getOperand</span>(<span class="number">1</span>) == &amp;I) </span><br><span class="line">                    &#123;</span><br><span class="line">                      <span class="keyword">if</span>(CCI2 &amp;&amp; CCI2-&gt;<span class="built_in">getValue</span>() == Con-&gt;<span class="built_in">getValue</span>())</span><br><span class="line">                      &#123;</span><br><span class="line">                        II-&gt;<span class="built_in">replaceAllUsesWith</span>(Var);</span><br><span class="line">                        DeadInsts.<span class="built_in">push_back</span>(II);</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//乘法除法存在溢出问题，不能优化</span></span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!DeadInsts.<span class="built_in">empty</span>()) </span><br><span class="line">  &#123;</span><br><span class="line">    Changed = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (Instruction *DeadI : DeadInsts) </span><br><span class="line">    &#123;</span><br><span class="line">      DeadI-&gt;<span class="built_in">eraseFromParent</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> Changed ? PreservedAnalyses::<span class="built_in">none</span>() : PreservedAnalyses::<span class="built_in">all</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="FileCheck"><a href="#FileCheck" class="headerlink" title="FileCheck"></a>FileCheck</h3><p>我偷懒只做了TastCase1.ll的filecheck，无法检查第三个pass，我附上TastCaseBasic的效果图</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">; 第一阶段：只运行 AlgebraicIdentityPass</span><br><span class="line">; RUN: opt -load-pass-plugin=%dylibdir/libLocalOpts.so \</span><br><span class="line">; RUN:     -p=algebraic-identity \</span><br><span class="line">; RUN:     -S %s -o %basename_t.algebraic</span><br><span class="line">; RUN: FileCheck --check-prefix=CHECK-ALGEBRAIC %s --input-file=%basename_t.algebraic</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; 第二阶段：运行 AlgebraicIdentityPass + StrengthReductionPass</span><br><span class="line">; RUN: opt -load-pass-plugin=%dylibdir/libLocalOpts.so \</span><br><span class="line">; RUN:     -p=algebraic-identity,strength-reduction \</span><br><span class="line">; RUN:     -S %s -o %basename_t.strength</span><br><span class="line">; RUN: FileCheck --check-prefix=CHECK-STRENGTH %s --input-file=%basename_t.strength</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; 第三阶段：运行所有 Pass</span><br><span class="line">; RUN: opt -load-pass-plugin=%dylibdir/libLocalOpts.so \</span><br><span class="line">; RUN:     -p=algebraic-identity,strength-reduction,multi-inst-opt \</span><br><span class="line">; RUN:     -S %s -o %basename_t.all</span><br><span class="line">; RUN: FileCheck --check-prefix=CHECK-ALL %s --input-file=%basename_t.all</span><br><span class="line"></span><br><span class="line">; <span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">; void foo(int a) &#123;</span><br><span class="line">;   int r0 = a + 0;</span><br><span class="line">;   int r1 = r0 * 16;</span><br><span class="line">;   int r2 = r1 * r0;</span><br><span class="line">;   int r3 = r2 / a;</span><br><span class="line">;   int r4 = r2 / 10;</span><br><span class="line">;   int r5 = 54 * r3;</span><br><span class="line">;   int r6 = r4 / 128;</span><br><span class="line">;   int r7 = r5 / 54;</span><br><span class="line">;   int r8 = r4 / 1;</span><br><span class="line">;   int r9 = r7 - 0;</span><br><span class="line">;   <span class="built_in">printf</span>(<span class="string">&quot;%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n&quot;</span>, r0, r1, r2, r3, r4, r5, r6, r7, r8,</span><br><span class="line">;          r9);</span><br><span class="line">; &#125;</span><br><span class="line"></span><br><span class="line">@.str = private unnamed_addr constant [31 x i8] c<span class="string">&quot;%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\0A\00&quot;</span>, align 1</span><br><span class="line"></span><br><span class="line">; 检查第一个pass</span><br><span class="line">; CHECK-ALGEBRAIC-LABEL: define dso_local void @foo(i32 noundef %0) &#123;</span><br><span class="line">; 检查加法优化：%2 = add nsw i32 %0, 0 → 被删除</span><br><span class="line">; CHECK-ALGEBRAIC-NOT:   add nsw i32 %0, 0</span><br><span class="line"></span><br><span class="line">; 检查乘法指令（使用%0替代%2）：</span><br><span class="line">; CHECK-ALGEBRAIC:       [[MUL1:%.*]] = mul nsw i32 %0, 16</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:  [[MUL2:%.*]] = mul nsw i32 [[MUL1]], %0</span><br><span class="line"></span><br><span class="line">; 检查除法指令：</span><br><span class="line">; CHECK-ALGEBRAIC:       [[DIV1:%.*]] = sdiv i32 [[MUL2]], %0</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:  [[DIV2:%.*]] = sdiv i32 [[MUL2]], 10</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:  [[MUL3:%.*]] = mul nsw i32 54, [[DIV1]]</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:  [[DIV3:%.*]] = sdiv i32 [[DIV2]], 128</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:  [[DIV4:%.*]] = sdiv i32 [[MUL3]], 54</span><br><span class="line"></span><br><span class="line">; 检查除法优化：%10 = sdiv i32 %6, 1 → 被删除</span><br><span class="line">; CHECK-ALGEBRAIC-NOT:   &#123;&#123;.*&#125;&#125; = sdiv i32 &#123;&#123;.*&#125;&#125;, 1</span><br><span class="line"></span><br><span class="line">; 检查减法优化：%11 = sub nsw i32 %9, 0 → 被删除</span><br><span class="line">; CHECK-ALGEBRAIC-NOT:   &#123;&#123;.*&#125;&#125; = sub nsw i32 &#123;&#123;.*&#125;&#125;, 0</span><br><span class="line"></span><br><span class="line">; 验证<span class="built_in">printf</span>调用参数（使用捕获的变量名）：</span><br><span class="line">; CHECK-ALGEBRAIC:       [[CALL1:%.*]] = call i32 (ptr, ...) @<span class="built_in">printf</span>(ptr noundef @.str, i32 noundef %0, i32 noundef [[MUL1]], i32 noundef [[MUL2]], i32 noundef [[DIV1]], i32 noundef [[DIV2]], i32 noundef [[MUL3]], i32 noundef [[DIV3]],  i32 noundef [[DIV4]], i32 noundef [[DIV2]], i32 noundef [[DIV4]])</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:       ret void</span><br><span class="line">; CHECK-ALGEBRAIC-NEXT:  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; 检查第二个pass</span><br><span class="line">; CHECK-STRENGTH-LABEL: define dso_local void @foo(i32 noundef %0) &#123;</span><br><span class="line">; CHECK-STRENGTH:       [[SHL1:%.*]] = shl i32 %0, 4</span><br><span class="line">; CHECK-STRENGTH-NOT:   &#123;&#123;.*&#125;&#125; = mul nsw i32 &#123;&#123;.*&#125;&#125;, 16</span><br><span class="line"></span><br><span class="line">; CHECK-STRENGTH:       [[SHIFT2:%.*]] = ashr i32 &#123;&#123;%.*&#125;&#125;, 7</span><br><span class="line">; CHECK-STRENGTH-NOT:   sdiv i32 &#123;&#123;.*&#125;&#125;, 128</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; 检查第三个pass</span><br><span class="line">; CHECK-ALL-LABEL:      define dso_local void @foo(i32 noundef %0) &#123;</span><br><span class="line">define dso_local void @foo(i32 noundef %0) &#123;</span><br><span class="line">  %2 = add nsw i32 %0, 0</span><br><span class="line">  %3 = mul nsw i32 %2, 16</span><br><span class="line">  %4 = mul nsw i32 %3, %2</span><br><span class="line">  %5 = sdiv i32 %4, %0</span><br><span class="line">  %6 = sdiv i32 %4, 10</span><br><span class="line">  %7 = mul nsw i32 54, %5</span><br><span class="line">  %8 = sdiv i32 %6, 128</span><br><span class="line">  %9 = sdiv i32 %7, 54</span><br><span class="line">  %10 = sdiv i32 %6, 1</span><br><span class="line">  %11 = sub nsw i32 %9, 0</span><br><span class="line">  %12 = call i32 (ptr, ...) @<span class="built_in">printf</span>(ptr noundef @.str, i32 noundef %2, i32 noundef %3, i32 noundef %4, i32 noundef %5, i32 noundef %6, i32 noundef %7, i32 noundef %8, i32 noundef %9, i32 noundef %10, i32 noundef %11)</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">declare</span> i32 @<span class="built_in">printf</span>(ptr noundef, ...) <span class="comment">#1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://kr0emer-blog-1306550410.cos.ap-nanjing.myqcloud.com/img/image-20250701120117722.png" alt="pass前"></p>
<p><img src="https://kr0emer-blog-1306550410.cos.ap-nanjing.myqcloud.com/img/image-20250701120035599.png" alt="pass后"></p>
<p>可以看到确实优化掉了<code>sub nsw i32 %3, 3</code>这行</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Kr0emer</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://kr0emer.com/2025/07/01/CSCD70 2023s Assignment 1 Introduction to LLVM 记录/">http://kr0emer.com/2025/07/01/CSCD70 2023s Assignment 1 Introduction to LLVM 记录/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Base/">Base</a></div><div class="social-share pull-right"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script><nav id="pagination"><div class="next-post pull-right"><a href="/2025/06/17/CSCD70%202023s%20Assignment%200%20Introduction%20to%20Docker%20%E8%AE%B0%E5%BD%95/"><span>CSCD70 2023s Assignment 0 Introduction to Docker 记录</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '699be94dd9838f660bbd',
  clientSecret: '68baa1120b9638dd3038c08ccb5d72c0da979cdc',
  repo: 'gitment-comments',
  owner: 'Kr0emer',
  admin: 'Kr0emer',
  id: md5(decodeURI(location.pathname)),
  language: 'zh-CN'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(https://kr0emer-blog-1306550410.cos.ap-nanjing.myqcloud.com/img/72177032_p0.png)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2025 By Kr0emer</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>